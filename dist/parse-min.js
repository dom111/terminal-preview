var parse=function(){var t={bg:"49",fg:"39",bold:!1,dim:!1,italic:!1,underline:!1,blink:!1,overline:!1,invert:!1,hidden:!1,strikethrough:!1},e=$.extend({},t),n=function(n){var c=$.extend({},t);return n=n.replace(/\b48;5;(\d+)\b/,"48_5_$1").replace(/\b38;5;(\d+)\b/,"38_5_$1").replace(/\b48;2;(\d+);(\d+);(\d+)\b/,"48_2_$1_$2_$3").replace(/\b38;2;(\d+);(\d+);(\d+)\b/,"38_2_$1_$2_$3"),n.split(/;/).forEach(function(t){0==t&&(c=$.extend({},e)),1==t&&(c.bold=!0),2==t&&(c.dim=!0),3==t&&(c.italic=!0),4==t&&(c.underline=!0),5==t&&(c.blink=!0),6==t&&(c.overline=!0),7==t&&(c.invert=!0),8==t&&(c.hidden=!0),9==t&&(c.strikethrough=!0),21==t&&(c.bold=!1),22==t&&(c.dim=!1),23==t&&(c.italic=!1),24==t&&(c.underline=!1),25==t&&(c.blink=!1),26==t&&(c.overline=!1),27==t&&(c.invert=!1),28==t&&(c.hidden=!1),29==t&&(c.strikethrough=!1),(match=t.match(/^38_2_(\d+)_(\d+)_(\d+)$/))?c.fg=a("true-"+match.slice(1).join("-")):(match=t.match(/^38_5_(\d+)$/))?c.fg=a("256-"+match[1]):(match=t.match(/^(3|9)[0-79]$/))&&(c.fg=t),(match=t.match(/^^48_2_(\d+)_(\d+)_(\d+)$/))?c.bg=a("true-"+match.slice(1).join("-"),!0):(match=t.match(/^48_5_(\d+)$/))?c.bg=a("256-"+match[1],!0):(match=t.match(/^(4|10)[0-79]$/))&&(c.bg=t)}),c},a=function(t,e){var n,a=e?"4":"3",c=e?"10":"9";return(n=t.match(/^true-(\d+)-(\d+)-(\d+)/))&&(n=i(n.slice(1),!0))&&(t="256-"+n),(n=t.match(/^256-(\d+)/))&&(n[1]<16?t=n[1]<8?a+n[1]:c+n[1]%8:16==n[1]?t=a+"0":231==n[1]&&(t=c+"7")),t},c=function(t){var e="\\e[";return[{key:"bg",n:48},{key:"fg",n:38}].forEach(function(n){var a;(a=t[n.key].match(/true-(\d+)-(\d+)-(\d+)/))?e+=n.n+";2;"+a.slice(1).join(";"):(a=t[n.key].match(/256-(\d+)/))?e+=n.n+";5;"+a[1]+";":t[n.key]&&(e+=t[n.key]+";")}),["bold","dim","italic","underline","blink","overline","invert","hidden","strikethrough"].forEach(function(n,a){t[n]&&(e+=++a+";")}),(e=e.replace(/;$/,""))+"m"},r=function(t){for(var e,n,a,c={stylingReset:/^(?:\\\[)?(?:\\033|\\e|\\x1[bB]|\x1b)\[(0?)m(?:\\\])?/,styling:/^(?:\\\[)?(?:\\033|\\e|\\x1[bB]|\x1b)\[([^m]*)m(?:\\\])?/,command:/^(?:\\\[)?(?:\\?`([^`]+)\\?`|\\?\$\(([^)]+)\))(?:\\\])?/,octal:/^\\(\d{3})/,hex:/^\\x([0-9a-fA-F]{2})/,token:/^( |\\[!#$@\\0aAdehHjlnsTtuvVWw])/,variable:/^\$\{?(\w+|\?)\}?/,text:/^([\S\s])/},r=[];t;)a=!1,Object.keys(c).forEach(function(s){!a&&(e=t.match(c[s]))&&(a=!0,"text"===s&&r.length&&"text"===(n=r[r.length-1]).type?(n.content+=e[0],n.value+=e[0]):"command"==s?r.push({type:s,content:e[0],value:e[1]||e[2]||"",wrap:e[0].match(/^\\\[/)&&e[0].match(/\\\]$/)}):r.push({type:s,content:e[0],value:e[1],wrap:e[0].match(/^\\\[/)&&e[0].match(/\\\]$/)}),t=t.replace(c[s],""))});return r},s=function(a){var c="",r=function(){var e=[];return t.invert?(e.push("bg-"+t.fg),e.push("fg-"+t.bg)):(e.push("bg-"+t.bg),e.push("fg-"+t.fg)),["bold","dim","italic","underline","overline","strikethrough","blink","hidden"].forEach(function(n){t[n]&&e.push(n)})," "+e.join(" ")};return t=$.extend({},e),a.forEach(function(e){var a=function(t){return t=t||"",t.replace(/"/g,"&quot;")};e.type.match(/styling/)?(c.match(/<span class="block styling/)&&(c+="</span>"),$.extend(t,e.style=n(e.value)),c+='<span class="block styling'+r()+'" data-content="'+a(e.content)+'" data-value="'+a(e.value)+'" data-type="'+e.type+'" style="'+((e.style.fg+"").match(/true-/)?(e.style.fg+"").replace(/true-/,"color: rgb(").replace(/$/,");").replace(/\-/g,","):"")+((e.style.bg+"").match(/true-/)?(e.style.bg+"").replace(/\-/g,",").replace(/true,/,"background-color: rgb(").replace(/$/,")"):"")+'"><span class="content">'+e.content+"</span>"):"command"===e.type?c+='<span class="block '+e.type+'" data-content="'+a(e.content)+'" data-value="'+a(e.value)+'"><span class="content">'+(e.wrap?'<span class="wrap">\\[</span>':"")+"$("+e.value+")"+(e.wrap?'<span class="wrap">\\]</span>':"")+"</span></span>":"token"===e.type?c+='<span class="block '+e.type+'" data-content="'+a(e.content)+'" data-value="'+a(e.value)+'" data-type="'+e.type+'"><span class="content">'+e.content+"</span></span>":"text"===e.type?c+='<span class="block '+e.type+'" data-content="'+a(e.content)+'" data-value="'+a(e.value)+'" data-type="'+e.type+'">'+e.content+"</span>":"variable"===e.type?c+='<span class="block '+e.type+'" data-content="'+a(e.content)+'" data-value="'+a(e.value)+'" data-type="'+e.type+'"><span class="content">'+e.content+"</span></span>":"hex"===e.type?c+='<span class="block '+e.type+'" data-content="'+a(e.content)+'" data-value="'+a(String.fromCharCode(parseInt(e.value,16)))+'" data-type="'+e.type+'"><span class="content">'+e.content+"</span></span>":"octal"===e.type&&(c+='<span class="block '+e.type+'" data-content="'+a(e.content)+'" data-value="'+a(String.fromCharCode(parseInt(e.value,8)))+'" data-type="'+e.type+'"><span class="content">'+e.content+"</span></span>")}),c+='<span class="cursor"></span>',c.match(/<span class="block styling/)&&(c+="</span>"),c},o=function(t){return s(r(t))},l=function(){var t=[];return t.push([0,0,0,0]),t.push([128,0,0,1]),t.push([0,128,0,2]),t.push([128,128,0,3]),t.push([0,0,128,4]),t.push([128,0,128,5]),t.push([0,128,128,6]),t.push([192,192,192,7]),t.push([128,128,128,8]),t.push([255,0,0,9]),t.push([0,255,0,10]),t.push([255,255,0,11]),t.push([0,0,255,12]),t.push([255,0,255,13]),t.push([0,255,255,14]),t.push([255,255,255,15]),[0,95,135,175,215,255].forEach(function(e){[0,95,135,175,215,255].forEach(function(n){[0,95,135,175,215,255].forEach(function(a){t.push([e,n,a,16+parseInt(""+Math.floor(e/255*5)+Math.floor(n/255*5)+Math.floor(a/255*5),6)])})})}),[8,18,28,38,48,58,68,78,88,98,108,118,128,138,148,158,168,178,188,198,208,218,228,238].forEach(function(e){t.push([e,e,e,232+Math.floor(e/10)])}),t}(),p=function(t,e){return t.slice(0).sort(function(t,n){return Math.abs(t[0]-e[0])+Math.abs(t[1]-e[1])+Math.abs(t[2]-e[2])-(Math.abs(n[0]-e[0])+Math.abs(n[1]-e[1])+Math.abs(n[2]-e[2]))||t[3]-n[3]})[0]},u=function(t,e){return a("256-"+(p(l.slice(0,16),t)||[])[3],e)},i=function(t,e){return e?(e=l.filter(function(e){return e[0]==t[0]&&e[1]==t[1]&&e[2]===t[2]})[0]||[],e[3]):(p(l,t)||[])[3]},h=function(t){return 49==t?l[0].slice(0,3):39==t?l[7].slice(0,3):t<50?l[t%10].slice(0,3):l[t%10+8].slice(0,3)},d=function(t){var e=[];return l[t][3]==t?l[t].slice(0,3):($.each(l,function(n){n[3]==t&&(e=n.slice(0,3))}),e)},f=function(t){var e=0,n=0,a=0;return t=t.replace(/^#/,""),3===t.length?(e=parseInt(t[0]+t[0],16),n=parseInt(t[1]+t[1],16),a=parseInt(t[2]+t[2],16)):6===t.length&&(e=parseInt(t[0]+t[1],16),n=parseInt(t[2]+t[3],16),a=parseInt(t[4]+t[5],16)),[e,n,a]},b=function(t){return"#"+t.map(function(t){return(0+t.toString(16)).substr(-2)}).join("")};return o.extract=r,o.process=s,o.rgbToTerm256=i,o.rgbToTerm16=u,o.term256ToRgb=d,o.term16ToRgb=h,o.simplifyColour=a,o.hexToRgb=f,o.rgbToHex=b,o.parseStyles=n,o.buildStyles=c,o.defaultStyle=e,o}();
